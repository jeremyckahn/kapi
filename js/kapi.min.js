function kapi(o,p,q){function k(a,b,c){var d,e;if(!b)return a;if(u.call(b)==="[object Array]"){if(!b.length)return a;e=b.slice(1);b=b.shift()}else b=b;a=a||{};for(d in b)if(b.hasOwnProperty(d))if(typeof b[d]==="object"&&d!=="prototype"){if(!a[d]||c)a[d]=u.call(b[d])==="[object Array]"?[]:{};k(a[d],b[d],c)}else if(typeof a[d]==="undefined"||c)a[d]=b[d];return k(a,e,c)}function v(a,b,c,d,e,g){if((g||this._currentFrame)>=b)return kapi.tween[a]((g||this._currentFrame)-b,d,e-d,c-b||1)}function w(a){this[a]=
this.style[a].replace(/px/gi,"")||this._params[a]}function x(a){return a.sort(function(b,c){return b-c})}function y(a){return typeof a==="string"&&/^#([0-9]|[a-f]){6}$/i.test(a)}function r(a){return typeof a==="string"&&/^rgb\(\d+\s*,\d+\s*,\d+\s*\)\s*$/i.test(a)}function s(a){return parseInt(a,16)}function z(a){if(typeof a==="string"){a=a.replace(/#/g,"");return[s(a.substr(0,2)),s(a.substr(2,2)),s(a.substr(4,2))]}else return[0,0,0]}function A(a){if(typeof a!=="string")return a;if(/^(#|rgb)/.test(a))if(/^#/.test(a))return z(a);
else{a=a.match(/\d+/g);return[+a[0],+a[1],+a[2]]}else return a}function t(a){return typeof a==="string"&&/^\s*(\+|\-|\*|\/)\=\d+\s*$/.test(a)}function B(a){return typeof a==="number"||typeof a==="function"||t(a)||y(a)||r(a)}var E={fillColor:"#f0f",fRate:20},u=Object.prototype.toString,C={ms:function(a){return a*this._params.fRate/1E3},s:function(a){return a*this._params.fRate}},D={"+=":function(a,b){return a+b},"-=":function(a,b){return a-b},"*=":function(a,b){return a*b},"/=":function(a,b){return a/
b}};return{init:function(a,b,c){var d;b=b||{};c=c||{};k(b,E);this._params=b;this._params.canvas=a;this.events=c;this.el=a;this.ctx=a.getContext("2d");this._keyframeIds=[];this._reachedKeyframes=[];this._keyframes={};this._actorStateIndex={};this._keyframeCache={};this._originalStates={};this._liveCopies={};this._currentState={};this.fCount=this._animationDuration=0;for(d in this._params.styles)if(this._params.styles.hasOwnProperty(d))this.el.style[d]=this._params.styles[d];if(this._params.styles){this._params.styles.height&&
w.call(this.el,"height");this._params.styles.width&&w.call(this.el,"width")}return this},getVersion:function(){return"0.1"},isPlaying:function(){return this._isStopped===false&&this._isPaused===false},play:function(){var a;a=+new Date;if(!this.isPlaying()){this._isStopped=this._isPaused=false;if(!this._startTime)this._startTime=a;if(this._loopStartTime){a=a-this._pausedAtTime;this._loopStartTime+=a;this._startTime+=a}else this._loopStartTime=a;this.updateState();return this}},pause:function(){clearTimeout(this._updateHandle);
this._pausedAtTime=+new Date;this._isPaused=true;return this},stop:function(){var a;clearTimeout(this._updateHandle);delete this._loopStartTime;delete this._pausedAtTime;this._isStopped=true;for(a in this._actorStateIndex)if(this._actorStateIndex.hasOwnProperty(a))this._actorStateIndex[a].queue=[];this.ctx.clearRect(0,0,this.el.width,this.el.height);return this},add:function(a,b){var c={};c.draw=a;c.params=b;c.constructor=a;c.name=a.name;return this._keyframize(c)},gotoFrame:function(a){var b=+new Date;
this.isPlaying()&&this.stop();this._currentFrame=a=this._getRealKeyframe(a)%this._lastKeyframe;this._loopStartTime=this._startTime=b-a*this._params.fRate;this._pausedAtTime=b;this._reachedKeyframes=this._keyframeIds.slice(0,this._getLatestKeyframeId(this._keyframeIds));this.ctx.clearRect(0,0,this.el.width,this.el.height);this._updateActors(this._currentFrame);return this},gotoAndPlay:function(a){this.gotoFrame(a);return this.play()},getState:function(){return this._currentState},updateState:function(){var a=
this,b=+new Date;this.fCount++;return this._updateHandle=setTimeout(function(){var c,d;a._loopLength=b-a._loopStartTime;if(a._loopLength>a._animationDuration&&a._reachedKeyframes.length===a._keyframeIds.length){a._hasHitValidFrame=false;a._loopStartTime=a._startTime+parseInt((b-a._startTime)/(a._animationDuration||1),10)*a._animationDuration;a._loopLength-=a._animationDuration||a._loopLength;a._reachedKeyframes=[];a._keyframeCache={}}a._loopPosition=a._animationDuration?a._loopLength/a._animationDuration:
0;a._currentFrame=parseInt(a._loopPosition*a._lastKeyframe,10);c=a._getLatestKeyframeId(a._keyframeIds);c=c===-1?a._lastKeyframe:a._keyframeIds[c];if(c>((a._reachedKeyframes.length>0?a._reachedKeyframes[a._reachedKeyframes.length-1]:undefined)||0)){a._reachedKeyframes.push(c);for(d in a._keyframeCache)if(a._keyframeCache.hasOwnProperty(d))a._keyframeCache[d]={from:a._keyframeCache[d].to,to:{}}}c=a._reachedKeyframes.length?a._reachedKeyframes.length-1:0;if(a._reachedKeyframes[c]!==a._keyframeIds[c])a._currentFrame=
a._reachedKeyframes[c]=a._keyframeIds[c];if(a._currentFrame<=a._lastKeyframe){a.ctx.clearRect(0,0,a.el.width,a.el.height);typeof a.events.enterFrame==="function"&&a.events.enterFrame.call(a);a._updateActors(a._currentFrame)}a.updateState()},1E3/this._params.fRate)},_updateActors:function(a){var b,c,d,e,g;for(b in this._actorStateIndex)if(this._actorStateIndex.hasOwnProperty(b)){if(typeof this._actorStateIndex[b][0]!=="undefined"&&a>=this._actorStateIndex[b][0]){c=this._getActorState(b);if(c!==null){e=
this._actorStateIndex[b].queue;if((g=e.length)>0){if(e[0]._internals.fromState===null)e[0]._internals.fromState=c;d=this._getQueuedActionState(e);k(c,d,true);if(g!==e.length){d=this._getLatestKeyframeId(this._actorStateIndex[b]);this._keyframes[this._keyframeIds[d]][b]=c}}c.prototype.draw.call(c,this.ctx)}}this._currentState[b]=c}},_getActorState:function(a){var b=this._actorStateIndex[a],c=this._getLatestKeyframeId(b),d,e,g;if(c===-1)return null;d=this._getNextKeyframeId(b,c);e=this._keyframes[b[c]][a];
g=this._keyframes[b[d]][a];if(c===d&&this._lastKeyframe>0)return null;this._keyframeCache[a]||(this._keyframeCache[a]={from:{},to:{}});return this._calculateCurrentFrameProps(e,g,b[c],b[d],g.easing)},_getQueuedActionState:function(a){var b=+new Date,c=a[0],d=c._internals;if(d.startTime===null)d.startTime=b;if(!d.pauseBufferUpdated)d.pauseBufferUpdated=b;if(d.pauseBufferUpdated<this._pausedAtTime){d.pauseBuffer+=b-this._pausedAtTime;d.pauseBufferUpdated=b}if(d.toState===null){d.toState={};k(d.toState,
d.fromState);k(d.toState,c.state,true)}d.currFrame=(b-(d.startTime+d.pauseBuffer))/1E3*this._params.fRate;d.currFrame>c.duration&&a.shift();return this._calculateCurrentFrameProps(d.fromState,d.toState,0,+c.duration,c.easing||d.fromState.easing,{currentFrame:d.currFrame})},_calculateCurrentFrameProps:function(a,b,c,d,e,g){var j,h,i,f,l,n,m={};e=kapi.tween[e]?e:"linear";g=g||{};for(h in a)if(a.hasOwnProperty(h)){i=a[h];f=a.prototype.id;if(typeof this._keyframeCache[f].from[h]!=="undefined")i=this._keyframeCache[f].from[h];
else if(typeof i==="function"||t(i)){if(typeof i==="function")i=i.call(a)||0;else{j=i.match(/(\+|\-|\*|\/)\=/)[0];l=this._getPreviousKeyframeId(this._actorStateIndex[f]);l=l===-1?a.prototype.params[h]||0:this._keyframes[l][f][h];i=D[j](l,+i.replace(/\D/g,""))}this._keyframeCache[f].from[h]=i}if(B(i)){l=false;f=b[h];n=b.prototype.id;if(typeof this._keyframeCache[n].to[h]!=="undefined")f=this._keyframeCache[n].to[h];else if(typeof f==="function"||t(f)){if(typeof f==="function")f=f.call(b)||0;else{j=
f.match(/(\+|\-|\*|\/)\=/)[0];f=D[j](i,+f.replace(/\D/g,""))}this._keyframeCache[n].to[h]=f}j=typeof i;if(!B(f)||j!==typeof f)m[h]=i;else{if(typeof i==="string"){l=true;i=A(i);f=A(f)}if(l){m[h]="rgb(";for(j=0;j<i.length;j++)m[h]+=Math.floor(v.call(this,e,c,d,i[j],f[j],g.currentFrame))+",";m[h]=m[h].replace(/,$/,")")}else m[h]=v.call(this,e,c,d,i,f,g.currentFrame)}}}k(m,a);return m},_getPreviousKeyframeId:function(a){return this._getLatestKeyframeId(a)-1},_getLatestKeyframeId:function(a){var b;if(this._currentFrame===
0)return 0;if(this._currentFrame>a[a.length-1])return-1;for(b=a.length-1;b>=0;b--)if(a[b]<this._currentFrame)return b;return a.length-1},_getNextKeyframeId:function(a,b){return b===a.length-1?b:b+1},_keyframize:function(a){var b=this;if(typeof a.id==="undefined")a.id=a.params.id||a.params.name||parseInt((""+Math.random()).substr(2),10)+ +new Date;if(typeof this._actorStateIndex[a.id]==="undefined"){this._actorStateIndex[a.id]=[];this._actorStateIndex[a.id].queue=[]}a.keyframe=function(c,d){var e=
k({},d);d.prototype=this;try{c=b._getRealKeyframe(c)}catch(g){window.console&&window.console.error&&console.error(g);return}if(c<0)throw"keyframe "+c+" is less than zero!";if(c>0&&typeof b._keyframes["0"]==="undefined"){b._keyframes["0"]={};b._keyframeIds.unshift(0)}if(typeof b._keyframes[c]==="undefined")b._keyframes[c]={};if(typeof b._originalStates[c]==="undefined")b._originalStates[c]={};b._keyframes[c][a.id]=d;b._originalStates[c][a.id]=e;b._updateKeyframes(a,c);k(d,a.params);b._updateAnimationDuration();
return this};a.to=function(c,d){var e;e=b._actorStateIndex[a.id].queue;e.push({duration:b._getRealKeyframe(c),state:d});e=e[e.length-1];e._internals={};e._internals.startTime=null;e._internals.fromState=null;e._internals.toState=null;e._internals.pauseBuffer=null;e._internals.pauseBufferUpdated=null;return this};a.remove=function(c){var d,e,g=false;c=b._getRealKeyframe(c);if(b._keyframes[c]&&b._keyframes[c][a.id]){delete b._keyframes[c][a.id];delete b._originalStates[c][a.id];for(d in b._keyframes[c])if(b._keyframes[c].hasOwnProperty(d))g=
true;if(!g&&c!==0){delete b._keyframes[c];delete b._originalStates[c];for(d=0;d<b._keyframeIds.length;d++)if(b._keyframeIds[d]===c){b._keyframeIds.splice(d,1);break}for(d=0;d<b._reachedKeyframes.length;d++)if(b._reachedKeyframes[d]===c){b._reachedKeyframes.splice(d,1);break}}for(d=0;d<b._actorStateIndex[a.id].length;d++)b._actorStateIndex[a.id][d]===c&&b._actorStateIndex[a.id].splice(d,1);c in b._liveCopies&&delete b._liveCopies[c];for(e in b._liveCopies)b._liveCopies.hasOwnProperty(e)&&b._liveCopies[e].copyOf===
c&&a.remove(e);b._updateAnimationDuration()}else if(console&&console.error)b._keyframes[c]?console.error("Trying to remove "+a.id+" from keyframe "+c+", but "+a.id+" does not exist at that keyframe."):console.error("Trying to remove "+a.id+" from keyframe "+c+", but keyframe "+c+" does not exist.");return this};a.updateKeyframe=function(c,d){var e;c=b._getRealKeyframe(c);if(b._keyframes[c]&&b._keyframes[c][a.id]){e=b._originalStates[c][a.id];k(e,d,true);a.keyframe(c,e)}else if(window.console&&window.console.error)b._keyframes[c]?
console.error("Keyframe "+c+" does not contain "+a.id):console.error("Keyframe "+c+" does not exist.");return this};a.liveCopy=function(c,d){c=b._getRealKeyframe(c);d=b._getRealKeyframe(d);if(b._keyframes[d]&&b._keyframes[d][a.id]){b._liveCopies[c]={actorId:a.id,copyOf:d};a.keyframe(c,{})}else if(window.console&&window.console.error)b._keyframes[d]?console.error("Trying to make a liveCopy of "+d+", but  "+a.id+" does not exist at keyframe "+c+"."):console.error("Trying to make a liveCopy of "+d+", but keyframe "+
d+" does not exist.");return this};a.getState=function(){return b._currentState[a.id]||{}};a.get=function(c){return a.getState()[c]};return a},_getRealKeyframe:function(a){var b;if(typeof a==="number")return parseInt(a,10);else if(typeof a==="string"){a=a.replace(/\s/g,"");b=/^(\d|\.)+/.exec(a)[0];a=/\D+$/.exec(a);if(!a)return parseInt(b,10);if(C[a])b=parseInt(C[a].call(this,b),10);else throw"Invalid keyframe identifier unit!";return b}else throw"Invalid keyframe identifier type!";},_updateKeyframes:function(a,
b){this._updateKeyframeIdsList(b);this._normalizeActorAcrossKeyframes(a.id);this._updateLiveCopies();this._updateActorStateIndex(a,{add:b})},_updateKeyframeIdsList:function(a){var b;for(b=0;b<this._keyframeIds.length;b++)if(this._keyframeIds[b]===a)return;this._keyframeIds.push(a);x(this._keyframeIds)},_normalizeActorAcrossKeyframes:function(a){var b,c,d=this._keyframeIds.length,e,g,j,h;for(h=0;h<d;h++){b=this._keyframeIds[h];e=this._keyframes[b][a];if(typeof c!=="undefined"){g=this._keyframes[c][a];
k(e,g)}for(j in e)if(e.hasOwnProperty(j))if(y(e[j])||r(e[j])){g=e;var i=j,f;f=e[j];var l=void 0;if(r(f))f=f;else{l=z(f);f="rgb("+l[0]+","+l[1]+","+l[2]+")"}g[i]=f}if(e)c=b}},_updateActorStateIndex:function(a,b){var c=this._actorStateIndex[a.id],d=false,e;if(typeof b.add!=="undefined"){for(e=0;e<c.length;e++)if(c[e]===b.add)d=true;if(!d){c.push(b.add);x(c)}}},_updateLiveCopies:function(){for(var a in this._liveCopies)if(this._liveCopies.hasOwnProperty(a))this._keyframes[a][this._liveCopies[a].actorId]=
this._keyframes[this._liveCopies[a].copyOf][this._liveCopies[a].actorId]},_updateAnimationDuration:function(){this._lastKeyframe=this._keyframeIds.length>0?this._keyframeIds[this._keyframeIds.length-1]:undefined;this._animationDuration=1E3*(this._lastKeyframe/this._params.fRate)}}.init(o,p,q)}kapi.tween={linear:function(o,p,q,k){return q*o/k+p}};